<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="author" content="kinjouj" />
    <meta name="robots" content="index,follow,noarchive" />
    <meta name="referrer" content="unsafe-url" />
    <meta name="google-site-verification" content="AsHuqJn6JTx4Dv28BuiAGoIs12P5qrs4VtBmoBX2kow" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content=" Android4.0以前だとonReceiveメソッドをそのままインスタンスメソッドとしてAndroidTestCaseを使ってテスト出来たんですけど、Android4.0からだとエラーになる。そのエラーになるケースがsetResultExtrasを使った場合になるんですが[APIドキュメント][1]によると 

 
Change the current result extras of this broadcast; only works with broadcasts sent through Context.sendOrderedBroadcast. This is a Bundle holding arbitrary data, whose interpretation is up to the broadcaster. Can be set to null. Calling this method completely replaces the current map (if any).
This method does not work with non-ordered broadcasts such as those sent with Context.sendBroadcast
 

 って書いちゃってんすよね。英語読める訳じゃないけど、要するにsetResultExtrasを使う場合はonReceiveをそのまま実行してもsendBroadcastでやっても出来ないらしいっぽい事を書いてる気がする。じゃあどないすんねんと。まぁ書いてあるとおりにsendBroadcastではなく、sendOrderedBroadcastを使えとの事らしいので " />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@kinjou__j" />
    <meta name="twitter:creator" content="@kinjou__j" />
    <meta name="twitter:url" content="https://kinjouj.github.io" />
    <meta name="twitter:title" content="android.content.BroadcastReceiver Using Android ICS of android.test.AndroidTestCase">
    <meta name="twitter:description" content=" Android4.0以前だとonReceiveメソッドをそのままインスタンスメソッドとしてAndroidTestCaseを使ってテスト出来たんですけど、Android4.0からだとエラーになる。そのエラーになるケースがsetResultExtrasを使った場合になるんですが[APIドキュメント][1]によると 

 
Change the current result extras of this broadcast; only works with broadcasts sent through Context.sendOrderedBroadcast. This is a Bundle holding arbitrary data, whose interpretation is up to the broadcaster. Can be set to null. Calling this method completely replaces the current map (if any).
This method does not work with non-ordered broadcasts such as those sent with Context.sendBroadcast
 

 って書いちゃってんすよね。英語読める訳じゃないけど、要するにsetResultExtrasを使う場合はonReceiveをそのまま実行してもsendBroadcastでやっても出来ないらしいっぽい事を書いてる気がする。じゃあどないすんねんと。まぁ書いてあるとおりにsendBroadcastではなく、sendOrderedBroadcastを使えとの事らしいので 

">
    <title>android.content.BroadcastReceiver Using Android ICS of android.test.AndroidTestCase - kinjouj.github.io</title>
    <link rel="canonical" href="https://kinjouj.github.io/" />
    <link rel="stylesheet" type="text/css" href="/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link rel="stylesheet" type="text/css" href="/css/prism.css" />
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-56169419-1', 'auto');
      ga("send", "pageview");
    </script>
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div>
          <header class="logo-header center">
            <h2><a href="/">kinjouj.github.io</a></h2>
          </header>
        </div>
        <nav class="navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="/about.html">about</a></li>
            <li><a href="/contact.html">お問い合わせ</a></li>
          </ul>
        </nav>
      </div>
    </nav>
    <div class="container">
      <header>
        <div class="ad">
          <section>
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3593764998780061" data-ad-slot="5207980923" data-ad-format="auto"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
          </section>
        </div>
      </header>
      <div id="content">
        <div class="entry" style="width: 100%">
          <h3 class="entry-title">android.content.BroadcastReceiver Using Android ICS of android.test.AndroidTestCase</h3>
          <p class="meta">
            2012-01-07T00:00:00+00:00
            <span class="categories">
              <a class="category" href="/categories/android">Android</a>
              <a class="category" href="/categories/java">Java</a>
            </span>
          </p>
          <div class="entry-content">
            <p>Android4.0以前だとonReceiveメソッドをそのままインスタンスメソッドとしてAndroidTestCaseを使ってテスト出来たんですけど、Android4.0からだとエラーになる。そのエラーになるケースがsetResultExtrasを使った場合になるんですが[APIドキュメント][1]によると</p>

<blockquote>
Change the current result extras of this broadcast; only works with broadcasts sent through Context.sendOrderedBroadcast. This is a Bundle holding arbitrary data, whose interpretation is up to the broadcaster. Can be set to null. Calling this method completely replaces the current map (if any).
This method does not work with non-ordered broadcasts such as those sent with Context.sendBroadcast
</blockquote>

<p>って書いちゃってんすよね。英語読める訳じゃないけど、要するにsetResultExtrasを使う場合はonReceiveをそのまま実行してもsendBroadcastでやっても出来ないらしいっぽい事を書いてる気がする。じゃあどないすんねんと。まぁ書いてあるとおりにsendBroadcastではなく、sendOrderedBroadcastを使えとの事らしいので</p>



<h4>SampleBroadcastReceiver.java</h4>
<pre><code class="language-java")>package sample.test;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;

public class SampleBroadcastReceiver extends BroadcastReceiver {

    public static final String ACTION = "sample.test.receiver";

    @Override
    public void onReceive(final Context context, Intent intent) {
        if (ACTION.equals(intent.getAction())) {
            if (isOrderedBroadcast()) {
                Bundle bundle = new Bundle();
                bundle.putString("name", "hoge");

                setResultExtras(bundle);
            }
        }
    }
}
</code></pre>
<p>まぁあくまで検証目的なので適当に。OrderedBroadcastが必要な部分だけisOrderedBroadcastでブロック切り分ければ良いはず</p>

<h4>SampleBroadcastReceiverTestCase.java</h4>
<pre><code class="language-java")>package sample.test;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Bundle;
import android.test.AndroidTestCase;
import android.util.Log;

public class SampleBroadcastReceiverTestCase extends AndroidTestCase {

    private BroadcastReceiver receiver = new BroadcastReceiver() {
        @Override
        public void onReceive(Context ctx, Intent intent) {
            Bundle bundle = getResultExtras(false);

            Log.v("TAG",bundle.toString());

            assertNotNull(bundle);
            assertEquals(bundle.getString("name"), "hoge");
        }
    };

    public void test() {
        Context ctx = getContext();

        IntentFilter filter = new IntentFilter();
        filter.addAction(SampleBroadcastReceiver.ACTION);

        ctx.registerReceiver(new SampleBroadcastReceiver(), filter);

        Intent intent = new Intent(SampleBroadcastReceiver.ACTION);

        ctx.sendOrderedBroadcast(intent, null, receiver, null, 1, null, null);
    }
}
</code></pre>
<p>まぁやってみると</p>

<ul>
<li>SampleBroadcastReceiverTestCase</li>
<li>SampleBroadcastReceiver</li>
<li>SampleBroadcastReceiverTestCase(receiver)</li>
</ul>

<p>という流れで行く模様。ただテスト側がfailするコード書いてもEclipse上でAndroid JUnitでテストを動かしてもSuccessfulにしかならない。けど、logcatすると思いっきりエラー出てる。なのでこれのテストをする場合にはlogcatを見ながらじゃないとテスト出来ないというオチがあるんですけど</p>

<p>まぁこれで良いかは非常に微妙な所なんだけど、とりあえずはこんな感じでテスト出来る模様</p>

<p>[1]: <a href="http://developer.android.com/reference/android/content/BroadcastReceiver.html#setResultExtras">http://developer.android.com/reference/android/content/BroadcastReceiver.html#setResultExtras</a><br /></p>

          </div>
          <p class="meta">
            <a class="pull-right box-link" href="/2011/12/xmlhttprequest-prototype-open-by-unit-test.html">XMLHttpRequest.prototype.open by Unit Test</a>
          </p>
          <div style="clear: both"></div>
        </div>
      </div>
      <div style="margin: 50px 0px">
        <aside class="sidebar">
          <div class="row">
            <div class="col-md-4 col-xs-4 col-sm-4">
              <!-- noop -->
            </div>
            <div class="col-sm-4 col-xs-4 col-md-4">
              <section>
                <h4>Recent Posts</h4>
                <ul id="recent_posts">
                  <li class="post">
                    <a href="/2018/07/jwt-authentication-rails.html">RailsでJWT認証</a>
                  </li>
                  <li class="post">
                    <a href="/2018/07/graphql-1-graphqljs.html">graphql.jsを使ってみた</a>
                  </li>
                  <li class="post">
                    <a href="/2018/06/almin-and-react-routing-resolver.html">almin+react-routing-resolver</a>
                  </li>
                  <li class="post">
                    <a href="/2018/06/typescript-project-building-using-webpack.html">webpackでTypeScriptプロジェクトをビルド</a>
                  </li>
                  <li class="post">
                    <a href="/2018/06/typescript-project-building-using-react-script-ts.markdown.html">react-script-tsを使ってTypeScriptプロジェクトをビルド</a>
                  </li>
                  <li class="post">
                    <a href="/2018/05/es7-function-bind.html">ES7でのfunction bind</a>
                  </li>
                  <li class="post">
                    <a href="/2017/11/es7-decorators.html">ES7 Decoratorsを試す</a>
                  </li>
                  <li class="post">
                    <a href="/2017/11/webpack-inject-variable.html">webpackで変数を注入</a>
                  </li>
                </ul>
              </section>
            </div>
            <div id="categories" class="col-md-4 col-xs-4 col-sm-4">
              <section>
                <h4>Categories</h4>
                <ul>
  <li>
    <a href="/categories/java.html">Java (238)</a>
  </li>
  <ul>
  <li>
    <a href="/categories/sastruts.html">SAStruts (9)</a>
  </li>
  <li>
    <a href="/categories/spring-framework.html">Spring Framework (26)</a>
  </li>
  <li>
    <a href="/categories/mahout.html">Mahout (4)</a>
  </li>
  <li>
    <a href="/categories/gradle.html">gradle (32)</a>
  </li>
  <li>
    <a href="/categories/java-ee.html">Java EE (2)</a>
  </li>
  <li>
    <a href="/categories/rxjava.html">RxJava (3)</a>
  </li>
  <li>
    <a href="/categories/android.html">Android (100)</a>
  </li>
  <ul>
  <li>
    <a href="/categories/robolectric.html">robolectric (10)</a>
  </li>
</ul>

  <li>
    <a href="/categories/kotlin.html">Kotlin (1)</a>
  </li>
  <li>
    <a href="/categories/struts2.html">Struts2 (16)</a>
  </li>
  <li>
    <a href="/categories/google-app-engine.html">Google App Engine (9)</a>
  </li>
  <li>
    <a href="/categories/doma.html">doma (5)</a>
  </li>
  <li>
    <a href="/categories/hadoop.html">Hadoop (11)</a>
  </li>
  <li>
    <a href="/categories/eclipse-birt.html">Eclipse BIRT (7)</a>
  </li>
  <li>
    <a href="/categories/scala.html">scala (1)</a>
  </li>
  <li>
    <a href="/categories/groovy.html">groovy (1)</a>
  </li>
  <li>
    <a href="/categories/jax-rs.html">JAX-RS (22)</a>
  </li>
</ul>

  <li>
    <a href="/categories/php.html">PHP (63)</a>
  </li>
  <ul>
  <li>
    <a href="/categories/laravel.html">Laravel (20)</a>
  </li>
  <li>
    <a href="/categories/phpunit.html">PHPUnit (3)</a>
  </li>
  <li>
    <a href="/categories/smarty.html">Smarty (1)</a>
  </li>
  <li>
    <a href="/categories/fuelphp.html">FuelPHP (33)</a>
  </li>
</ul>

  <li>
    <a href="/categories/javascript.html">JavaScript (161)</a>
  </li>
  <ul>
  <li>
    <a href="/categories/chrome-extension.html">Chrome Extension (38)</a>
  </li>
  <li>
    <a href="/categories/node-dot-js.html">Node.js (17)</a>
  </li>
  <li>
    <a href="/categories/backbone-dot-js.html">Backbone.js (6)</a>
  </li>
  <li>
    <a href="/categories/grunt.html">grunt (1)</a>
  </li>
  <li>
    <a href="/categories/redux.html">redux (1)</a>
  </li>
  <li>
    <a href="/categories/react-dot-js.html">React.js (7)</a>
  </li>
  <li>
    <a href="/categories/webpack.html">webpack (2)</a>
  </li>
  <li>
    <a href="/categories/typescript.html">TypeScript (1)</a>
  </li>
  <li>
    <a href="/categories/almin.html">almin (1)</a>
  </li>
  <li>
    <a href="/categories/npapi.html">NPAPI (4)</a>
  </li>
  <li>
    <a href="/categories/native-client.html">Native Client (8)</a>
  </li>
  <li>
    <a href="/categories/jquery.html">jQuery (6)</a>
  </li>
  <li>
    <a href="/categories/gulp.html">gulp (1)</a>
  </li>
  <li>
    <a href="/categories/angular-dot-js.html">angular.js (40)</a>
  </li>
</ul>

  <li>
    <a href="/categories/eclipse.html">Eclipse (6)</a>
  </li>
  <li>
    <a href="/categories/linux.html">Linux (9)</a>
  </li>
  <ul>
  <li>
    <a href="/categories/postfix.html">postfix (2)</a>
  </li>
  <li>
    <a href="/categories/shellscript.html">shellscript (1)</a>
  </li>
  <li>
    <a href="/categories/supervisord.html">supervisord (4)</a>
  </li>
</ul>

  <li>
    <a href="/categories/html5.html">HTML5 (8)</a>
  </li>
  <li>
    <a href="/categories/fluentd.html">fluentd (4)</a>
  </li>
  <li>
    <a href="/categories/ruby.html">Ruby (47)</a>
  </li>
  <ul>
  <li>
    <a href="/categories/rspec.html">rspec (21)</a>
  </li>
  <li>
    <a href="/categories/rails.html">Rails (34)</a>
  </li>
</ul>

  <li>
    <a href="/categories/css.html">CSS (6)</a>
  </li>
  <li>
    <a href="/categories/c.html">C (5)</a>
  </li>
  <ul>
  <li>
    <a href="/categories/c-plus-plus.html">C++ (10)</a>
  </li>
  <li>
    <a href="/categories/objective-c.html">Objective-C (1)</a>
  </li>
</ul>

  <li>
    <a href="/categories/nginx.html">nginx (4)</a>
  </li>
  <li>
    <a href="/categories/python.html">Python (7)</a>
  </li>
  <li>
    <a href="/categories/sonota.html">その他 (12)</a>
  </li>
  <li>
    <a href="/categories/artifactory.html">artifactory (1)</a>
  </li>
  <li>
    <a href="/categories/jenkins.html">Jenkins (3)</a>
  </li>
  <li>
    <a href="/categories/database.html">Database (1)</a>
  </li>
  <ul>
  <li>
    <a href="/categories/hbase.html">HBase (3)</a>
  </li>
  <li>
    <a href="/categories/mongodb.html">MongoDB (15)</a>
  </li>
  <li>
    <a href="/categories/cassandra.html">Cassandra (10)</a>
  </li>
  <li>
    <a href="/categories/mysql.html">MySQL (2)</a>
  </li>
</ul>

  <li>
    <a href="/categories/git.html">git (1)</a>
  </li>
  <li>
    <a href="/categories/beanstalk.html">beanstalk (1)</a>
  </li>
  <li>
    <a href="/categories/jwt.html">JWT (1)</a>
  </li>
  <li>
    <a href="/categories/graphql.html">GraphQL (1)</a>
  </li>
</ul>

              </section>
            </div>
          </div>
        </aside>
      </div>
    </div>
    <script src="/js/prism.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/start-sw.js"></script>
    <footer>
      <div class="footer-content">
        Powered by gress(octopress like site generator)
      </div>
    </footer>
  </body>
</html>
